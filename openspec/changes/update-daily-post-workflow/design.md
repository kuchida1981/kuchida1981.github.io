# Design: Automated Pull Request Merging

## 1. Context
The goal is to automatically merge pull requests generated by the daily post workflow after a 24-hour review window. This requires a reliable mechanism to trigger a merge action after a specific duration.

## 2. Goals
- Merge pull requests automatically after 24 hours.
- The merge should only proceed if all required status checks have passed.
- The solution should be robust and rely on well-supported tools, minimizing third-party dependencies where possible.

## 3. Decisions

### Chosen Approach: Scheduled Workflow with `gh` CLI

We will implement a new, separate GitHub Actions workflow that runs on an hourly schedule.

- **Workflow File:** `.github/workflows/automerge.yaml`
- **Trigger:** `schedule` (cron: `0 * * * *`)
- **Logic:**
    1.  The workflow will use the `gh` CLI, which is pre-installed on GitHub-hosted runners.
    2.  It will fetch all open pull requests with the `automerge-24h` label.
    3.  For each PR, it will check if the `createdAt` timestamp is older than 24 hours.
    4.  If the conditions are met, it will use `gh pr merge <pr-number> --merge` to merge the pull request. The `--merge` flag ensures it respects branch protection rules, including required status checks.

### Rationale
- **Reliability:** A scheduled job is resilient. If one run fails, the next hourly run can pick up the work. A long-running `sleep` command in a single workflow is fragile and can be terminated.
- **Minimal Dependencies:** This approach relies only on the official `gh` CLI, avoiding the need to vet and trust third-party actions for a core repository operation like merging.
- **Clarity and Separation of Concerns:** The logic for creating PRs (`daily-post.yaml`) is kept separate from the logic for merging them (`automerge.yaml`), making each workflow easier to understand and maintain.

## 4. Alternatives Considered

### Alternative 1: Using a Third-Party "Merge Schedule" Action

- **Description:** Several actions exist on the GitHub Marketplace that allow scheduling a merge by adding a comment to the PR (e.g., `/schedule in 24 hours`).
- **Pros:** Simple to set up.
- **Cons:**
    - **Dependency Risk:** Introduces a dependency on a third-party developer. If the action is abandoned or has a security vulnerability, it poses a risk.
    - **Flexibility:** Can be less flexible than a custom script. Our logic is simple, but this might be a constraint in the future.

### Alternative 2: `sleep` Command within the Main Workflow

- **Description:** Add a `run: sleep 86400` step to the `daily-post.yaml` workflow before the merge step.
- **Pros:** Conceptually very simple.
- **Cons:**
    - **Unreliable:** GitHub Actions jobs have a maximum execution time (6 hours for private repos on the free plan, 72 hours for others, but this can be changed). A 24-hour sleep is not guaranteed to complete and is an inefficient use of runner resources.
    - **Fragile:** If the job is cancelled or fails for any reason, the merge will not happen, and there is no automatic retry.

## 5. Open Questions
- None at this time. The chosen approach is straightforward and low-risk.
